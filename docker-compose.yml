# MUSE: 10B Japanese LLM - Docker Compose

version: '3.8'

services:
  muse:
    build:
      context: .
      dockerfile: Dockerfile
    image: muse-llm:latest
    container_name: muse-dev

    # GPU
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [ gpu ]

    # Ports
    ports:
      - "8888:8888" # Jupyter (optional)

    # Volumes
    volumes:
      - ./data:/workspace/data
      - ./checkpoints:/workspace/checkpoints
      - ./configs:/workspace/configs

    # Environment
    environment:
      - CUDA_VISIBLE_DEVICES=0
      - PYTHONUNBUFFERED=1
      - PYTHONPATH=/workspace

    stdin_open: true
    tty: true
    command: /bin/bash

# ==========================================
# Usage:
# ==========================================
#
# Start container:
#   docker-compose up -d
#
# Enter shell:
#   docker-compose exec muse bash
#
# Train Japanese LLM:
#   docker-compose exec muse make start-japanese
#
# Chat with model:
#   docker-compose exec muse make chat
#
# Stop:
#   docker-compose down
