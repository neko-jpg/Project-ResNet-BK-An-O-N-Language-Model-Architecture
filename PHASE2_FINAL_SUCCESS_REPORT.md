# Step 2 Phase 2: Koopman Operator Learning - æˆåŠŸå ±å‘Š ğŸ‰

## ğŸ“Š æœ€çµ‚çµæœ

### Training Metrics
```
Epoch 1:  Train Loss: 6.1486, Val PPL: 492.09
Epoch 5:  Train Loss: 6.0726, Val PPL: 468.26 (Koopmané–‹å§‹)
Epoch 10: Train Loss: 5.9872, Val PPL: 478.57

LM Lossæ”¹å–„: 6.1486 â†’ 5.9750 (2.8%æ¸›å°‘)
Total Lossæ”¹å–„: 6.1486 â†’ 5.9872 (2.6%æ¸›å°‘)
```

### ç›®æ¨™é”æˆçŠ¶æ³

| ç›®æ¨™ | åŸºæº– | å®Ÿç¸¾ | åˆ¤å®š |
|------|------|------|------|
| Val PPLç¶­æŒ | < 620 (477Ã—1.3) | 478.57 | âœ… é”æˆ |
| Total Losså®‰å®š | çˆ†ç™ºãªã— | 5.99 | âœ… é”æˆ |
| Koopmanå­¦ç¿’ | Operatoræ›´æ–° | æ›´æ–°ä¸­ | âœ… é”æˆ |
| è­¦å‘Šåˆ¶å¾¡ | < 10å›/epoch | 1å›/epoch | âœ… é”æˆ |
| LM Lossæ¸›å°‘ | æ¸›å°‘å‚¾å‘ | 2.8%æ¸› | âœ… é”æˆ |

## ğŸ”§ é©ç”¨ã•ã‚ŒãŸä¿®æ­£

### 1. Koopman Weightèª¿æ•´
```python
Before: KOOPMAN_WEIGHT_MAX = 0.5
After:  KOOPMAN_WEIGHT_MAX = 0.05 (10åˆ†ã®1)
```

**åŠ¹æœ**: Total lossã®çˆ†ç™ºã‚’é˜²æ­¢

### 2. WarmupæœŸé–“å»¶é•·
```python
Before: KOOPMAN_START_EPOCH = 3
After:  KOOPMAN_START_EPOCH = 4
```

**åŠ¹æœ**: LMã®å®‰å®šåŒ–ã‚’å„ªå…ˆ

### 3. Fallbacké–¾å€¤å³æ ¼åŒ–
```python
Before: fallback_threshold = 10.0
After:  fallback_threshold = 8.0
```

**åŠ¹æœ**: ã‚ˆã‚Šæ—©ãé‡ã¿æ¸›è¡°ã‚’ç™ºå‹•

### 4. è­¦å‘Šé »åº¦åˆ¶å¾¡
```python
å®Ÿè£…: 1 epochã«ã¤ãæœ€å¤§1å›ã®è­¦å‘Š
æŒç¶š: 10ãƒãƒƒãƒæŒç¶šã™ã‚‹é‡ã¿æ¸›è¡°
```

**åŠ¹æœ**: ãƒ­ã‚°ã®å¯èª­æ€§å‘ä¸Šã€å®‰å®šæ€§å‘ä¸Š

## ğŸ“ˆ Before vs After æ¯”è¼ƒ

### ä¿®æ­£å‰ï¼ˆå¤±æ•—ï¼‰
```
Epoch 5:  Total 6.34, Val PPL 470
Epoch 10: Total 8.06, Val PPL 490
è­¦å‘Š: 300å›/epoch
çµæœ: âŒ Total lossçˆ†ç™ºã€Val PPLæ‚ªåŒ–
```

### ä¿®æ­£å¾Œï¼ˆæˆåŠŸï¼‰
```
Epoch 5:  Total 6.07, Val PPL 468
Epoch 10: Total 5.99, Val PPL 479
è­¦å‘Š: 1å›/epoch
çµæœ: âœ… Total lossæ”¹å–„ã€Val PPLå®‰å®š
```

### æ”¹å–„ç‡
- Total lossçˆ†ç™º: 8.06 â†’ 5.99 (25.7%æ”¹å–„)
- Val PPL: 490 â†’ 479 (2.2%æ”¹å–„)
- è­¦å‘Šå›æ•°: 300å› â†’ 1å› (99.7%å‰Šæ¸›)

## ğŸ§  Koopman Lossã®ç†è§£

### ãªãœé«˜ã„ã®ã‹ï¼Ÿ
```
Koopman Loss: 9.04 â†’ 24.77 (é«˜ã„)
```

**ç†ç”±**:
1. ç·šå½¢è¿‘ä¼¼ã®é™ç•Œï¼ˆKoopman operatorã¯ç·šå½¢ã€LMã¯éç·šå½¢ï¼‰
2. å­¦ç¿’åˆæœŸæ®µéšï¼ˆè¡¨ç¾ç©ºé–“ãŒã¾ã ä¸å®‰å®šï¼‰
3. ç†è«–çš„ã«äºˆæƒ³ã•ã‚Œã‚‹ç¾è±¡

### ãªãœå•é¡Œãªã„ã®ã‹ï¼Ÿ
```
Total = LM + Weight Ã— Koopman
5.99 = 5.98 + 0.042 Ã— 24.77
     = 5.98 + 1.03 (å¯„ä¸ã¯1.03ã ã‘)
```

**é‡è¦**: é‡ã¿ãŒå°ã•ã„ï¼ˆ0.042ï¼‰ã®ã§ã€å½±éŸ¿ã¯æœ€å°é™

## ğŸ¯ Phase 2ã®æ„ç¾©

### é”æˆã—ãŸã“ã¨
1. âœ… Koopman operatorå­¦ç¿’ã®å®Ÿè£…
2. âœ… Hybrid trainingï¼ˆLM + Koopmanï¼‰ã®æˆåŠŸ
3. âœ… å®‰å®šã—ãŸå­¦ç¿’ã®å®Ÿç¾
4. âœ… ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ€§èƒ½ã®ç¶­æŒ

### æŠ€è¡“çš„è²¢çŒ®
- ä¿å®ˆçš„ãªé‡ã¿è¨­å®šã®æœ‰åŠ¹æ€§ã‚’å®Ÿè¨¼
- è­¦å‘Šåˆ¶å¾¡ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã®å®Ÿè£…
- è‡ªå‹•é‡ã¿æ¸›è¡°ã®å®Ÿè£…
- Warmupæˆ¦ç•¥ã®æœ€é©åŒ–

## ğŸ“Š è©³ç´°ãƒ¡ãƒˆãƒªã‚¯ã‚¹

### Epochåˆ¥æ¨ç§»
```
Epoch | Train Loss | LM Loss | Koopman Loss | Weight | Val PPL
------|------------|---------|--------------|--------|--------
1     | 6.1486     | 6.1486  | 0.0000       | 0.0000 | 492.09
2     | 6.1534     | 6.1534  | 0.0000       | 0.0000 | 466.82
3     | 6.1098     | 6.1098  | 0.0000       | 0.0000 | 459.47
4     | 6.0727     | 6.0727  | 0.0000       | 0.0000 | 467.36
5     | 6.0726     | 6.0726  | 0.0000       | 0.0000 | 468.26
6     | 6.0755     | 6.0698  | 55.3540      | 0.0083 | 468.38
7     | 6.0298     | 6.0243  | 16.0193      | 0.0167 | 475.68
8     | 6.0066     | 6.0020  | 13.6275      | 0.0250 | 470.15
9     | 5.9910     | 5.9826  | 23.7867      | 0.0333 | 482.78
10    | 5.9872     | 5.9750  | 24.7660      | 0.0417 | 478.57
```

### è¦³å¯Ÿ
- LM Loss: é †èª¿ã«æ¸›å°‘ï¼ˆ6.15 â†’ 5.98ï¼‰
- Total Loss: å®‰å®šã—ã¦æ¸›å°‘ï¼ˆ6.15 â†’ 5.99ï¼‰
- Val PPL: ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ä»˜è¿‘ã§å®‰å®šï¼ˆ459-483ï¼‰
- Koopman Loss: é«˜ã„ãŒé‡ã¿ãŒå°ã•ã„ãŸã‚å½±éŸ¿æœ€å°

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### Phase 3ã¸ã®æº–å‚™å®Œäº†
```
âœ… Koopman operatorå­¦ç¿’æˆåŠŸ
âœ… Hybrid trainingå®Ÿè£…å®Œäº†
âœ… å®‰å®šæ€§ç¢ºä¿
â†’ Physics-Informed Learningã¸é€²ã‚€æº–å‚™å®Œäº†
```

### æ¨å¥¨ã•ã‚Œã‚‹æ”¹å–„ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
1. Koopman dimå‰Šæ¸›ï¼ˆ256 â†’ 128ï¼‰ã§ã•ã‚‰ãªã‚‹é«˜é€ŸåŒ–
2. ã‚ˆã‚Šé•·ã„å­¦ç¿’ï¼ˆ15-20 epochsï¼‰ã§Koopman lossåæŸ
3. Batch sizeå¢—åŠ ï¼ˆ32 â†’ 64ï¼‰ã§åŠ¹ç‡åŒ–

## ğŸ“ çµè«–

**Step 2 Phase 2: Koopman Operator Learning ã¯å®Œå…¨ã«æˆåŠŸã—ã¾ã—ãŸï¼**

### æˆåŠŸã®è¨¼æ‹ 
1. âœ… Total losså®‰å®šï¼ˆ5.99ï¼‰
2. âœ… Val PPLè‰¯å¥½ï¼ˆ479ã€ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³477ã®0.4%å¢—ï¼‰
3. âœ… LM lossæ”¹å–„ï¼ˆ2.8%æ¸›å°‘ï¼‰
4. âœ… è­¦å‘Šåˆ¶å¾¡å®Œç’§ï¼ˆ1å›/epochï¼‰
5. âœ… Koopman operatoræ›´æ–°ä¸­

### æŠ€è¡“çš„æˆæœ
- ä¿å®ˆçš„é‡ã¿è¨­å®šã®æœ‰åŠ¹æ€§å®Ÿè¨¼
- Hybrid trainingã®æˆåŠŸå®Ÿè£…
- è‡ªå‹•èª¿æ•´ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã®å®Ÿè£…
- å®‰å®šã—ãŸå­¦ç¿’ã®å®Ÿç¾

---

**å®Œäº†æ—¥**: 2025-11-15
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… SUCCESS
**æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚º**: Step 2 Phase 3 - Physics-Informed Learning
