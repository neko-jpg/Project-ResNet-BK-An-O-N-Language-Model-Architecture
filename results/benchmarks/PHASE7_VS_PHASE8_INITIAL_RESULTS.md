# Phase 7 vs Phase 8 初期比較結果

**日時:** 2025-11-29  
**GPU:** NVIDIA GeForce RTX 3080 Laptop GPU (8GB VRAM)

## 結果サマリー

### 同一構成での比較 (d_model=4096, n_layers=32)

| Phase | Parameters | VRAM使用量 | 状態 |
|-------|-----------|-----------|------|
| **Phase 7** | 3.08B | **5.94 GB** | ✓ 成功 |
| **Phase 8** | 3.08B | **17.29 GB** | ✗ OOM (8GB超過) |

**差分:** Phase 8は Phase 7の **2.91倍のVRAM**を消費

## 問題点

### 1. メモリ効率の悪化

Phase 8で追加された機能により、同じパラメータ数でもVRAM消費が大幅に増加：

- **Phase 7:** 5.94 GB (1.83B相当)
- **Phase 8:** 17.29 GB (1.83B相当) → **+11.35 GB (+191%)**

### 2. 8GB VRAM制約の違反

Phase 8は8GB VRAMを大幅に超過しており、実用不可能。

### 3. 最適化の失敗

Phase 8の目標は「メモリ効率の改善」だったが、実際には**悪化**している。

## 原因分析

Phase 8で追加されたモジュールが追加のメモリを消費：

1. **HyperbolicSSM** - 状態空間モデルの状態保持
2. **TangentSpaceLinearAttention** - 接空間での計算
3. **追加の中間バッファ** - 双曲空間演算用

これらは**推論時の長文処理**（O(N)スケーリング）では効果を発揮するが、**モデル自体のメモリフットプリント**は増加。

## Phase 7の実績（参考）

Phase 7では以下の構成が8GB VRAM内で動作：

| 構成 | d_model | n_layers | Parameters | VRAM |
|------|---------|----------|-----------|------|
| Maximum | 4096 | 32 | 1.83B | 6.89 GB |
| Large | 3072 | 48 | 1.54B | 5.83 GB |
| Deep | 2048 | 64 | 0.92B | 3.47 GB |

## 結論

**Phase 8は現状、Phase 7よりメモリ効率が悪い。**

Phase 8の利点（O(N)メモリスケーリング）は長文処理で発揮されるが、基本的なモデルサイズでは不利。

## 推奨事項

1. **Phase 8のメモリ最適化を実装**
   - Gradient checkpointingの強化
   - 不要なモジュールのオプション化
   - メモリ効率の良い実装への置き換え

2. **Phase 8の強みを活かす用途に特化**
   - 長文処理（8192+ tokens）
   - 推論専用モード
   - 量子化版の実装

3. **Phase 7をベースラインとして維持**
   - 8GB VRAM環境では Phase 7が最適
   - Phase 8は24GB+ VRAM環境向け

---

**作成日:** 2025-11-29  
**ステータス:** Phase 8はメモリ最適化が必要
